# Локальный сервер авторизации

## Описание

---

Механика установки виджета в CRM-систему не позволяет получить все реквизиты для входа на стороне клиентского приложения как в момент самой установки, так и во время дальнейшего использования.

Поэтому для этих целей необходим отдельный бэкенд. Если он по какой-то причине недоступен, то на этапе разработки/тестирования можно воспользоваться локальным сервером авторизации.

При первом запуске выполняется обмен временного ключа (действителен в течение 30 минут с момента получения) на пару `access` и `refresh` токенов.

В последующие запуски выполняется проверка действительности сохранённого токена доступа и его обмен на новый (только если уже не действителен).

Если срок действия токена доступа истёк во время работы сервера, то для получения нового токена следует его перезапустить.

Токены доступа и обмена сохраняются в `./auth-dev-server/secrets.json`

## Как пользоваться:

---

- Заполнить (только при первом запуске) реквизиты для входа ([см. ниже](#конфигурация))

- Запустить (каждый раз пепед запуском приложения):

        npm run auth-dev-server

## Конфигурация

---

- В директории `./auth-dev-server` скопировать и переименовать файл `example.secrets.json` -> `secrets.json`

- Заполнить параметры в соответствии с используемым амо-аккаунтом и интеграцией:

  `accountDomain` - домен аккаунта

  `subdomain` - поддомен аккаунта

  `code` - временный ключ интеграции для получения первой пары токенов

  `x_api_key` - nopaper-api-key

  `client_id` - id интеграции

  `client_secret` - секрет интеграции

  `redirect_uri` - адрес для веб-хука о подключении интеграции

## Эндпоинты

---

Запрос на получение токена доступа:

```javascript
POST localhost:5200/access_token;
```

Request:

```javascript
{
  "xApiKey": string
}
```

Response:

```javascript res
{
  "accessToken": string,
}
```
